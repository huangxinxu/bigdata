{% extends "index.html" %} {% block mainbody %}

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title></title>
    <meta charset="utf-8" />
<!-- 引入Bootstrap样式 -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">

<link href="/static/css/fileinput.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>

<script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.js"></script>
<script src="/static/js/fileinput.min.js"></script>
<script src="/static/js/fileinput_locale_zh.js"></script>
    <script src="/static/js/echarts.min.js"></script>

</head>
<title></title>
<style>

</style>
<div class="container">
<div class="container-fluid">
	<div class="row">
		<div class="col-md-8">
			<div class="row">
				<div class="col-md-12">
					<h3>
						训练输出
					</h3>
					<div class="progress">
						<div class="progress-bar w-75">
						</div>
					</div>
					<div id="main" style="width: 500px;height:400px;"></div>
				</div>
			</div>
			<div class="row">
				<div class="col-md-12">
					<h3>
						预测输出
					</h3>
					<div class="row">
						<form action=""  style="height:200px" method="post" enctype="multipart/form-data" >
                          {% csrf_token %}
                          {{ ImgForm.as_p }}
                         <button class="btn btn-info form-control " type="submit" value="submit">提交预测图片</button>
                        </form>
                    </div>
                    <div class="row">
						<div class="col-md-4">
							<img alt="Bootstrap 预览图片" src="{{ in_image_url }}" />
						</div>
						<div class="col-md-4">
							<img alt="Bootstrap 预览图片" src="{{ out_image_url }}" />
						</div>
					</div>
                    <div class="row">
						<div class="col-md-4">输入</div>
						<div class="col-md-4">输出</div>
					</div>
				</div>
			</div>
		</div>
		<div class="col-md-4">
			<h3>
				操作按钮
			</h3>

			<div class="btn-group btn-group-lg" role="group">

				<form action="" method="post" enctype="multipart/form-data" >
                  {% csrf_token %}
                  {{ ModelPthForm.as_p }}
                 <button class="btn btn-info form-control " type="submit" value="submit">提交模型权重</button>
                </form>
                <form action="{% url 'mae' %}" method="get">

                <input type="hidden" id="train" name="train" value="train">
				<button class="btn btn-secondary" type="submit">
					训练
				</button>
                </form>
			</div>
            <div  style="height:20px"></div>
            <p>已有模型:  {{ pthname }}<br> 创建时间:  {{ ctime }}<br> 最近修改时间:  {{ mtime }}</p>
		</div>
	</div>
</div>
</div>
<script>

var myChart = echarts.init(document.getElementById('main'));


    let base = +new Date(1968, 9, 3);
let oneDay = 24 * 3600 * 1000;
let date = [];
let data = {{  data_json }};
{#let data = [Math.random() * 300];#}
for (let i = 1; i < 20; i++) {
  var now = new Date((base += oneDay));
  {#date.push([now.getFullYear(), now.getMonth() + 1, now.getDate()].join('/'));#}
    date.push(i*5);
  {#data.push(Math.round((Math.random() - 0.5) * 20 + data[i - 1]));#}
}
console.log(date)
console.log(data)
option = {
  tooltip: {
    trigger: 'axis',
    position: function (pt) {
      return [pt[0], '100%'];
    }
  },
  title: {
    left: 'center',
    text: '训练损失'
  },
  {#toolbox: {#}
  {#  feature: {#}
  {#    dataZoom: {#}
  {#      yAxisIndex: 'none'#}
  {#    },#}
  {#    restore: {},#}
  {#    saveAsImage: {}#}
  {#  }},#}
  xAxis: {
    type: 'category',
    boundaryGap: false,
    data: date
  },
  yAxis: {
    type: 'value',
    boundaryGap: [0, '100%']
  },
  dataZoom: [
    {
      type: 'inside',
      start: 0,
      end: 10
    },
    {
      start: 0,
      end: 10
    }
  ],
  series: [
    {
      name: 'Fake Data',
      type: 'line',
      symbol: 'none',
      sampling: 'lttb',
      itemStyle: {
        color: 'rgb(255, 70, 131)'
      },
      areaStyle: {
        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
          {
            offset: 0,
            color: 'rgb(255, 158, 68)'
          },
          {
            offset: 1,
            color: 'rgb(255, 70, 131)'
          }
        ])
      },
      data: data
    }
  ]
};
        myChart.setOption(option);

</script>
{% endblock %}
